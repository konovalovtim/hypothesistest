/*! Hypotests Snippet v0.1.0 | MIT License */
var HypotestsSnippet=(()=>{var A=Object.defineProperty;var m=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var g=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,d=(e,t)=>{for(var o in t||(t={}))C.call(t,o)&&g(e,o,t[o]);if(m)for(var o of m(t))I.call(t,o)&&g(e,o,t[o]);return e};var K="0.1.0",p="hypotests:visitorId",h="hypotests_vid";var S="/api/api/v1/assign",E="/api/api/v1/events";function N(){if(typeof window=="undefined")return{};let e=(()=>{let o=document.currentScript;if(!o)return{};let n=o.dataset||{},r={};return n.apiBase&&(r.apiBaseUrl=n.apiBase),n.experimentKey&&(r.experimentKey=n.experimentKey),n.platform&&(r.platform=n.platform),n.region&&(r.region=n.region),n.debug&&(r.debug=n.debug==="true"),r})(),t=window.hypotestsConfig||window.__hypotestsConfig||{};return d(d({apiBaseUrl:"http://localhost:8080",assignEndpoint:S,eventEndpoint:E,debug:!1,variants:{}},t),e)}function f(e,...t){e.debug&&typeof console!="undefined"&&console.log("[Hypotests]",...t)}function u(e,...t){typeof console!="undefined"&&console.warn&&console.warn("[Hypotests]",...t)}function O(e){if(typeof document=="undefined")return null;let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([.$?*|{}()\[\]\\/+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null}function b(e,t){if(typeof document=="undefined")return;let o=new Date(Date.now()+31536e3*1e3);document.cookie=`${e}=${encodeURIComponent(t)}; path=/; expires=${o.toUTCString()}; SameSite=Lax`}function _(e){if(typeof window=="undefined")return null;try{return window.localStorage.getItem(e)}catch(t){return null}}function v(e,t){if(typeof window!="undefined")try{window.localStorage.setItem(e,t)}catch(o){}}function x(){if(typeof crypto!="undefined"&&crypto.randomUUID)return crypto.randomUUID();let e=Math.random().toString(16).slice(2);return`${Date.now().toString(16)}-${e}`}function D(){let e=_(p);if(e)return e;let t=O(h);if(t)return v(p,t),t;let o=x();return v(p,o),b(h,o),o}function U(){if(typeof navigator=="undefined")return;let e=navigator.userAgent||"";return/Mobi|Android/i.test(e)?"mobile":"desktop"}function k(e,t){if(t&&/^https?:\/\//i.test(t)||!e)return t;if(!t)return e;try{return new URL(t,e).toString()}catch(o){let n=e.endsWith("/"),r=t.startsWith("/");return n&&r?e+t.slice(1):!n&&!r?`${e}/${t}`:e+t}}async function w(e,t,o,n){let r=k(e.apiBaseUrl,e.assignEndpoint||S),a={experimentKey:e.experimentKey,visitorId:t,platform:o,region:n};f(e,"Request assignment",a,r);let s=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},keepalive:!0,body:JSON.stringify(a)});if(!s.ok)throw new Error(`Assignment failed with status ${s.status}`);let i=await s.json();return f(e,"Received assignment",i),i}function y(e,t,o,n,r={}){let a=k(e.apiBaseUrl,e.eventEndpoint||E),s=d({experimentKey:t.experimentKey,variantKey:t.variantKey,visitorId:o,eventType:n,userAgent:typeof navigator!="undefined"?navigator.userAgent:void 0,region:e.region,createdAt:new Date().toISOString()},r),i=JSON.stringify(s);if(f(e,"Send event",s,a),typeof navigator!="undefined"&&navigator.sendBeacon)try{let c=new Blob([i],{type:"application/json"});navigator.sendBeacon(a,c);return}catch(c){u(e,"sendBeacon failed, fallback to fetch",c)}fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},keepalive:!0,body:i}).catch(c=>u(e,"Fetch event failed",c))}function L(e,t,o){Array.isArray(t)&&t.forEach(n=>{if(!n||!n.selector)return;let r=document.querySelector(n.selector);if(r)switch(n.type){case"text":r.textContent=n.value;break;case"html":r.innerHTML=n.value;break;case"attribute":n.name&&r.setAttribute(n.name,n.value);break;case"style":n.property&&(r.style[n.property]=n.value);break;case"class:add":n.value&&r.classList.add(n.value);break;case"class:remove":n.value&&r.classList.remove(n.value);break;default:u(e,"Unknown action type",n,o)}})}function T(e,t){if(!Array.isArray(e))return[];let o=[];return e.forEach(n=>{let r=document.querySelector(n);if(!r)return;let a=s=>t(s,n);r.addEventListener("click",a),o.push(()=>r.removeEventListener("click",a))}),o}function R(e){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()}function B(e){if(e.region)return e.region;if(typeof document!="undefined"){let t=document.querySelector('meta[name="hypotests-region"]');if(t&&t.content)return t.content}}function $(){let e=N();if(!e.experimentKey){u(e,"experimentKey is not configured");return}let t=D(),o=e.platform||U(),n=B(e);e.platform=o,n&&(e.region=n);let r={assignment:null,clickDetach:[]};function a(){let i=window.hypotests||{};i.version=K,i.visitorId=t,i.assignment=r.assignment,i.trackConversion=function(l={}){if(!r.assignment){u(e,"Conversion ignored, no assignment yet");return}y(e,r.assignment,t,"CONVERSION",l)},i.resetAssignment=async function(){try{r.assignment=await w(e,t,o,n),s()}catch(l){u(e,"Failed to reassign variant",l)}},window.hypotests=i}function s(){R(()=>{if(!r.assignment)return;let i=e.variants&&e.variants[r.assignment.variantKey];if(!i){f(e,"No variant config found for",r.assignment.variantKey);return}if(r.clickDetach.length&&(r.clickDetach.forEach(c=>c()),r.clickDetach=[]),L(e,i.actions,r.assignment.variantKey),Array.isArray(i.trackClicks)&&(r.clickDetach=T(i.trackClicks,()=>{y(e,r.assignment,t,"CLICK")})),typeof i.onApplied=="function")try{i.onApplied(r.assignment,e,t)}catch(c){u(e,"Variant onApplied threw an error",c)}})}w(e,t,o,n).then(i=>{r.assignment=i,a(),typeof window!="undefined"&&Array.isArray(window.dataLayer)&&window.dataLayer.push({event:"hypotests_assignment",experimentKey:i.experimentKey,variantKey:i.variantKey}),s(),y(e,i,t,"IMPRESSION")}).catch(i=>{u(e,"Failed to assign variant",i),a()})}$();})();
//# sourceMappingURL=snippet.min.js.map
